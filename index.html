<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🏫 NU:CLASS - 반편성 프로그램</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K0F0RV1BY8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-K0F0RV1BY8');
    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8781468706124486"
     crossorigin="anonymous"></script>

</head>
<body>

    <!-- 샘플 파일 다운로드 모달 -->
    <div id="sampleModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>샘플 파일 다운로드</h3>
            <p>원하는 형식을 선택하세요</p>

            <!-- 모달 팝업 - 샘플 다운로드 -->
            <div class="modal-buttons">
                <div class="sample-row">
                    <span class="sample-name">[PDF] 학년 문구 없음</span>
                    <a href="./sample-no_grade_text.pdf" download class="modal-btn download-btn">다운로드</a>
                    <button class="modal-btn apply-btn" onclick="applySamplePdf('sample-no_grade_text.pdf')">바로 적용</button>
                </div>
                <div class="sample-row">
                    <span class="sample-name">[PDF] 학년 문구 있음</span>
                    <a href="./sample-grade_text.pdf" download class="modal-btn download-btn">다운로드</a>
                    <button class="modal-btn apply-btn" onclick="applySamplePdf('sample-grade_text.pdf')">바로 적용</button>
                </div>
            </div>

            <button class="modal-close-btn" onclick="closeSampleModal()">닫기</button>
        </div>
    </div>

    <!-- 빨간불 모달 -->
    <div id="redFlagModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <h3>🚨 떨어져야 하는 학생 관리</h3>
            
            <!-- 탭 추가 -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #eee;">
                <button id="groupTab" class="tab-btn active" onclick="switchTab('group')">
                    개별 분리 방식(A:B:C)
                </button>
                <button id="teamTab" class="tab-btn" onclick="switchTab('team')">
                    1:N 방식(A:BCD)
                </button>
            </div>
            
            <!-- 기존 그룹 입력 영역 -->
            <div id="groupTabContent" class="tab-content">
                <div class="redflag-input-area">
                    <p style="color: #666; font-size: 13px; margin-bottom: 10px;">
                        같은 반이 되면 안 되는 학생들을 그룹으로 추가하세요.
                    </p>
                    
                    <!-- 학생 입력 -->
                    <div class="student-input-wrapper">
                        <input type="text" id="redFlagStudentInput" 
                               placeholder="학생 이름 입력 후 Enter"
                               autocomplete="off">
                    </div>
                    
                    <!-- 선택된 학생 태그 표시 -->
                    <div id="selectedStudentTags" class="student-tags"></div>
                    
                    <!-- 사유 입력 -->
                    <input type="text" id="redFlagReason" 
                           placeholder="사유 (선택사항)" 
                           style="width: 100%; margin-top: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    
                    <!-- 추가 버튼 -->
                    <button id="addRedFlagGroup" class="btn btn-danger" style="width: 100%; margin-top: 10px;">
                        그룹 추가
                    </button>
                </div>
                
                <!-- 구분선 -->
                <hr style="margin: 20px 0; border: none; border-top: 1px solid #eee;">
                
                <!-- 기존 그룹 목록 -->
                <div class="redflag-list-area">
                    <div id="redFlagGroupList" class="group-list"></div>
                </div>
            </div>
            
            <!-- 새로운 팀 입력 영역 -->
            <div id="teamTabContent" class="tab-content" style="display: none;">
                <div class="redflag-input-area">
                    <p style="color: #666; font-size: 13px; margin-bottom: 10px;">
                        <strong>지정 학생</strong>과 <strong>분리 학생들</strong>은 다른 반이어야 합니다.<br>
                        (분리 학생들끼리는 같은 반 가능)
                    </p>
                    
                    <!-- 팀장 입력 -->
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <label style="font-weight: bold; white-space: nowrap; min-width: 110px;">지정 학생(1명)</label>
                        <div class="student-input-wrapper" style="flex: 1;">
                            <input type="text" id="teamLeaderInput" 
                                   placeholder="지정 학생 이름 입력"
                                   autocomplete="off">
                        </div>
                    </div>
                    <div id="teamLeaderTag" class="student-tags" style="margin-bottom: 10px;"></div>

                    <!-- 팀원 입력 -->
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                        <label style="font-weight: bold; white-space: nowrap; min-width: 110px;">분리 학생(N명)</label>
                        <div class="student-input-wrapper" style="flex: 1;">
                            <input type="text" id="teamMemberInput" 
                                   placeholder="분리해야 할 학생 이름 입력 후 Enter"
                                   autocomplete="off">
                        </div>
                    </div>
                    <div id="teamMemberTags" class="student-tags"></div>
                    
                    <!-- 사유 입력 -->
                    <input type="text" id="teamReason" 
                           placeholder="사유 (선택사항)" 
                           style="width: 100%; margin-top: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                    
                    <!-- 추가 버튼 -->
                    <button id="addTeam" class="btn btn-danger" style="width: 100%; margin-top: 10px;">
                        그룹 추가
                    </button>
                </div>
                
                <!-- 구분선 -->
                <hr style="margin: 20px 0; border: none; border-top: 1px solid #eee;">
                
                <!-- 팀 목록 -->
                <div class="redflag-list-area">
                    <div id="teamList" class="group-list"></div>
                </div>
            </div>
            
            <button class="modal-close-btn" onclick="closeRedFlagModal()" style="margin-top: 20px;">
                닫기
            </button>
        </div>
    </div>


    <!-- ========== 로그인 화면 ========== -->
    <div id="loginScreen" class="screen">
        <div class="login-container">
            <h1>🏫 NU:CLASS</h1>
            <h3>학생 반편성 지원 프로그램</h3>
            <p class="login-notice">※ 비밀번호는 최초 로그인 시 자동 등록됩니다.<br>꼭 기록해두세요!</p>
            
            <form id="loginForm">
                <input type="text" id="schoolNameInput" list="schoolNameList" placeholder="학교 이름 (예: 한국고등학교)" required autocomplete="off">
                <datalist id="schoolNameList"></datalist>
                
                <input type="text" id="gradeInput" list="gradeList" placeholder="학년 입력 (예: 2학년)" required autocomplete="off">
                <datalist id="gradeList"></datalist>
                
                <input type="password" id="passwordInput" placeholder="비밀번호 (숫자 5자리)" maxlength="5" required>
                <button type="submit" class="login-button">로그인</button>
            </form>
            
            <button type="button" class="sample-download-btn" onclick="openSampleModal(false)">
                📄 샘플 파일 다운로드
            </button>

            <div id="loginMessage"></div>
        </div>
    </div>

    <!-- ========== 대시보드 화면 ========== -->
    <div id="dashboardScreen" class="screen" style="display: none;">
        <div class="container">
            
            <!-- 상단 학교 정보 -->
            <div class="school-info">
                <h2 id="schoolInfoText">학교명 - 학년</h2>
            </div>
            <h1>학생 반편성 지원 프로그램 📲NU:CLASS</h1>

            <!-- 고정 헤더 영역 -->
            <div class="sticky-header">
                
                <!-- 버튼 그룹 -->
                <div class="button-group">
                    <label for="pdfUpload" class="btn btn-orange">PDF 파일 선택</label>
                    <input type="file" id="pdfUpload" accept=".pdf" style="display: none;">
                    <button type="button" class="btn btn-gray" onclick="openSampleModal(true)">샘플</button>
                    
                    <button id="globalSwapButton" class="btn btn-green" disabled>바꾸기</button>
                    <button id="globalMoveButton" class="btn btn-purple" disabled>다른 반 이동</button>
                    <button id="undoButton" class="btn btn-gray" disabled>되돌리기</button>
                    <button id="sortByNameButton" class="btn btn-violet" disabled>학생 재정렬</button>
                    <button id="downloadPdfButton" class="btn btn-red" disabled>PDF(확인용) 다운로드</button>
                    <button id="downloadPdfPublicButton" class="btn btn-orange" disabled>PDF(공지용) 다운로드</button>
                    <button id="downloadExcelButton" class="btn btn-blue" disabled>엑셀(나이스용) 다운로드</button>
                    <button id="backupButton" class="btn btn-teal" disabled>백업</button>
                    <button id="restoreButton" class="btn btn-teal">복원</button>
                    <input type="file" id="jsonUpload" accept=".json" style="display: none;">
                    <button id="resetDataButton" class="btn btn-danger" disabled>데이터 초기화</button>
                    <button id="logoutButton" class="btn btn-dark">로그아웃</button>
                </div>

                <!-- 현재 현황 통계 테이블 -->
                <div id="statsContainer">
                    <div class="stats-header">
                        <h2>통계</h2>

                        <!-- 옵션 영역 (우측 배치) -->
                        <div class="stats-options">
                            <span class="view-mode-title">보기 방식</span>

                            <span class="option-label">그리드</span>

                            <label class="seg-radio">
                                <input type="radio" name="gridColumns" value="2" checked>
                                <span>2</span>
                            </label>

                            <label class="seg-radio">
                                <input type="radio" name="gridColumns" value="3">
                                <span>3</span>
                            </label>

                            <label class="seg-radio">
                                <input type="radio" name="gridColumns" value="4">
                                <span>4</span>
                            </label>

                            <label class="seg-check">
                                <input type="checkbox" id="showBirthdate" checked>
                                <span>생년월일</span>
                            </label>

                            <label class="seg-check">
                                <input type="checkbox" id="showGender" checked>
                                <span>성별</span>
                            </label>

                            <label class="seg-check">
                                <input type="checkbox" id="showSpecial" before>
                                <span>메모</span>
                            </label>
                            <button id="redFlagButton" class="btn btn-redflag" style="font-size: 13px;" >
                                🚨
                            </button>
                        </div>
                    </div>

                    <table id="currentStats">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>


            </div>

            <!-- 반별 학생 목록 컨테이너 -->
            <div id="dropZone" class="drop-zone">
                <div id="classesContainer" class="class-container"></div>
            </div>

            <!-- 변경 이력 -->
            <div id="historyContainer">
                <h2>변경 이력</h2>
                <ul id="historyList"></ul>
            </div>

        </div>
    </div>

    <!-- PDF.js 라이브러리 (PDF 파싱용) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <!-- SheetJS 라이브러리 (엑셀 생성용) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- jsPDF 라이브러리 (PDF 생성용) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <!-- 한글 폰트(Base64) -->
    <script src="nuclass_font.js"></script>

    <!-- 메인 스크립트 -->
    <script src="app.js"></script>

</body>
</html>